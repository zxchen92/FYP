{% extends 'base.html' %}
{% block content %}

<h1>Ta da!</h1>
<br>
<h2>Here's your recommendation for today!</h2>
<br>

<form action="{% url 'rate' %}" method="post" id="rating-form">

  <h3>It is <h1 class = "recommenderResults">{{ maps_link|safe }}</h1> </h3>
  {% csrf_token %}
  <div class="star-rating">
    <input type="radio" id="rating-5" name="rating" value="5">
    <label for="rating-5">5</label>
    <input type="radio" id="rating-4" name="rating" value="4">
    <label for="rating-4">4</label>
    <input type="radio" id="rating-3" name="rating" value="3">
    <label for="rating-3">3</label>
    <input type="radio" id="rating-2" name="rating" value="2">
    <label for="rating-2">2</label>
    <input type="radio" id="rating-1" name="rating" value="1">
    <label for="rating-1">1</label>
  </div>
  <br>
  <input type="hidden" id="food" name="food" value="{{ recommended_food }}">
  <button type="submit">Submit</button>
</form>
<br>

<table class="table table-striped table-bordered table-hover">
    <thead class="thead-dark">
      <tr>
        <th scope="col">Dish</th>
        <th scope="col">Category</th>
        <th scope="col">Dietary Restrictions</th>
      </tr>
    </thead>
    <tbody id="Category">

        {% for foodid, food_obj in food_dict.items %}
        <!-- <tr class = "clickable-row">
            <th scope="row">{{ food_obj.foodName }}</td> -->
            <tr class="clickable-row">
            <td onclick="searchOnMaps('{{ food_obj.foodName }}')">{{ food_obj.foodName }}</td>
            <td>{{ food_obj.foodCategory.categoryName}}</td>
            <td>{{ food_obj.dietary_restrictions }}</td>
        </tr>
    {% endfor %}

    </tbody>
  </table>

<br>
<table class="table table-striped table-bordered table-hover">
  <thead class="thead-dark">
    <tr>
      <th scope="col">Hawkers</th>
      <th scope="col">Postal Code</th>
      <th scope="col">Ratings(out of 5)</th>
    </tr>
  </thead>
  <tbody id="Category">
    

        <tr>
        <th scope="row">Ah Hock Noodles</th>
        <td>Maxwell Foodcourt</td>
        <td>4.5 stars</td>
        </tr>


  </tbody>
</table>

<!-- <div class="container">
  <div class="row">
    <div class="col-md-6">
      <div class="d-flex flex-column align-items-center">

        <a href="#" class="list-group-item list-group-item-action active text-center" aria-current="true">View your past Ratings!</a>
      </div>
    </div>
  </div>
</div> -->

<script>
$(document).ready(function(){
  $("#searchCategory").on("keyup", function() {
    var value = $(this).val().toLowerCase();
    $("#Category tr").filter(function() {
      $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
    });
  });
});

document.querySelectorAll('input[name="rating"]').forEach(function(radio) {
    radio.addEventListener('change', function(event) {
      console.log('Selected rating: ' + event.target.value);
    });
  });

  // get all the rows in the table
var rows = document.querySelectorAll(".clickable-row");

// get the first row in the table
var firstRow = document.querySelector(".clickable-row");
firstRow.classList.add("selected");

// add a click event listener to each row
rows.forEach(function(row) {
  row.addEventListener("click", function() {
    // remove the "selected" class from all the rows
    rows.forEach(function(row) {
      row.classList.remove("selected");
    });
    
    // add the "selected" class to the clicked row
    this.classList.add("selected");
    
    // disable all the rows except for the clicked row
    rows.forEach(function(row) {
      row.disabled = true;
    });
    this.disabled = false;
  });
});


function searchOnMaps(query) {
  // encode the query string to make it URL-safe
  var encodedQuery = encodeURIComponent(query);

  // construct the Google Maps search URL with the encoded query string
  var searchUrl = "https://www.google.com/maps/search/?api=1&query=" + encodedQuery;

  // open the search URL in a new tab
  window.open(searchUrl, "_blank");
}

</script>

<style>
  .selected {
    background-color: #a4c6d8 !important;
  }
  .clickable-row:not(.selected) {
  opacity: 0.5;
  filter: blur(1px);
}
</style>


{% endblock %}